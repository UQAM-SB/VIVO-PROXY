# VIVO-PROXY Client side API Demo

This space contains a scenario (several use-cases)for using VIVO-PROXY in bash mode


## Prerequisites

- Make sure that VIVO is accessible from `http://localhost:8080/vivo`
- Make sure that VIVO-PROXY is accessible from `http://localhost:9090`
- have access to the CURL command
- executing commands from this working directory: `VIVO-PROXY/bundles/ca.uqam.tool.vivo-proxy.client/dataIngestDemo`


# Use-cases:

## 1- Adding a person in VIVO

#### person API-URL

 `http://localhost:9090/vivoproxy/person`

#### The data model of aPerson.json

```json
{
  "personType": "http://vivoweb.org/ontology/core#FacultyMember",
  "firstName": "Peters",
  "lastName": "Jasper",
  "middleName": "I"
}
```

#### Send the person data model of VIVO-PROXY

```bash
curl -X 'POST' 'http://localhost:9090/vivoproxy/person'   -H 'accept: application/json'   -H 'Content-Type: application/json' -d @aPerson.json 
``` 

#### Type of response expected

```json
{"code":4,"type":"ok","apiMessage":null,"IRI-value":"http://localhost:8080/vivo/individual/n7723","VIVO-Message":" return code: 200 "}
```

- code 4 => Good result
- type ok => VIVO-PROXY has certainly worked
- apiMessage => No message expected
- IRI-value : http://localhost:8080/vivo/individual/n7723 => The IRI created in VIVO for this resource
- VIVO-Message : return code: 200 => VIVO server return code for this addition 

#### see result at:

http://localhost:8080/vivo/people

<hr>

## 2- Adding a list of person in VIVO 

#### createWithList API-URL

`http://localhost:9090/vivoproxy/person/createWithList`

#### The data model of aListOfPersons.json

```json
[
    {
        "personType": "http://vivoweb.org/ontology/core#EmeritusFaculty",
        "firstName": "Franklin",
        "lastName": "Pierce",
        "middleName": "J"
    },
    {
        "personType": "http://vivoweb.org/ontology/core#EmeritusFaculty",
        "firstName": "Franklin",
        "lastName": "Pierce",
        "middleName": "J"
    }
]
```

##### Send the persons list data model of VIVO-PROXY

```bash
curl -X 'POST' 'http://localhost:9090/vivoproxy/person/createWithList' -H 'accept: text/plain' -H 'Content-Type: application/json' -d @aListOfPersons.json
``` 

#### Expected type of response

```
_:genid1 <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#Ontology> .
#
#
# #################################################################
# #
# #    Annotation properties
. . .
# #################################################################
# #
# #    Individuals
# #
# #################################################################
#
#
# http://localhost:8080/vivo/individual/n2333
<http://localhost:8080/vivo/individual/n2333> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#NamedIndividual> .
. . .
<http://localhost:8080/vivo/individual/n2333> <http://www.w3.org/2000/01/rdf-schema#label> "Franklin J Pierce"@fr-ca .
#
# http://localhost:8080/vivo/individual/n2938
<http://localhost:8080/vivo/individual/n2938> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2002/07/owl#NamedIndividual> .
. . .
<http://vivoweb.org/ontology/core#EmeritusFaculty> .
<http://localhost:8080/vivo/individual/n2938> <http://www.w3.org/2000/01/rdf-schema#label> "Franklin J Pierce"@fr-ca .
#
# Generated by the OWL API (version 5.1.17.2020-11-07T15:03:35Z) https://github.com/owlcs/owlapi/
```

- Returns in TURTLE the IRI of the created resources
#### see result at:

http://localhost:8080/vivo/people

<hr>

## 3- Adding a prefered position to a person in VIVO

For this UC, it is necessary to 
1- create an organization (if it doesn't exist yet)
2- associate an existing person with an organization by providing the job title

#### organization and addPositionFor API's-URL

- `http://localhost:9090/vivoproxy/organization`
- `http://localhost:9090/vivoproxy/person/addPositionFor`

#### The data model of anOrganization.json

```json
{
  "organizationType": "http://vivoweb.org/ontology/core#University",
  "Name": "Université du Québec à Montréal"
}

```
#### The data model of aPersonPositionInOrganization.json

```json
{
  "personIRI": "http://localhost:8080/vivo/individual/GIVE-EXISTING-PERSON-IRI",
  "organisationIRI": "http://localhost:8080/vivo/individual/GIVE-EXISTING-ORGANIZATION-IRI",
  "organisationLabel": "Université du Québec à Montréal",
  "positionTitleLabel": "Professor",
  "positionTypeIRI": "http://vivoweb.org/ontology/core#FacultyPosition",
  "vivoOrganisationTypeIRI": "http://vivoweb.org/ontology/core#University",
  "startField_year": "2017",
  "endField_year": "2021"
}

```

#### Send the organization data model of VIVO-PROXY

```bash
curl -X 'POST' 'http://localhost:9090/vivoproxy/organization' -H 'accept: application/json' -H 'Content-Type: application/json' -d @anOrganization.json
``` 

#### Type of response expected

```json
{
  "code": 4,
  "type": "ok",
  "apiMessage": null,
  "IRI-value": "http://localhost:8080/vivo/individual/n7540",
  "VIVO-Message": " return code: 200 "
}
```
#### Send the aPersonPositionInOrganization data model of VIVO-PROXY

either the generated URIs : (to be adapted to your scenario)

- http://localhost:8080/vivo/individual/n7723 (your person IRI)
- http://localhost:8080/vivo/individual/n7540 (your organization IRI)



#### Send the addPositionFor data model of VIVO-PROXY

```bash
curl -X 'PUT' 'http://localhost:9090/vivoproxy/person/addPositionFor' -H 'accept: application/json' -H 'Content-Type: application/json' -d '{ "personIRI": "http://localhost:8080/vivo/individual/n7723", "organisationIRI": "http://localhost:8080/vivo/individual/n7540", "organisationLabel": "Harvard University", "positionTitleLabel": "Professor", "positionTypeIRI": "http://vivoweb.org/ontology/core#FacultyPosition", "vivoOrganisationTypeIRI": "http://vivoweb.org/ontology/core#University", "startField_year": "2017", "endField_year": "2020" }'
``` 
#### Type of response expected

```json
{"code":4,"type":"ok","apiMessage":null,"IRI-value":"http://localhost:8080/vivo/individual/n7723","VIVO-Message":"\r\n\r\n<!DOCTYPE html>\r\n<!-- wilma home.ftl  -->\r\n<html lang=\"fr-CA\">\r\n\r\n    <head>\r\n\r\n<meta charset=\"utf-8\" />\r\n<!--
Google Chrome Frame open source plug-in brings Google Chrome's open web technologies and s .......

```

- VIVO-Message => Contains the triples generated by the query


#### see result at:

- http://localhost:8080/vivo/organizations
- (for this scenario. Adapt this IRI to your scenario) http://localhost:8080/vivo/display/n7723 - you should see the position for this person 

<hr>

## 4- Describing a resource contained in VIVO

This UC is used to describe a resource in VIVO. In practice, this API sends a SPARQL DESCRIBE request to VIVO

#### Describe resource API-URL

`http://localhost:9090/vivoproxy/vivo?IRI=...`

#### Return MIME_TYPE accepted by this API

```
text/turtle:
text/plain:
application/ld+json:
text/n3:
text/owl-manchester:
text/owl-functional:
application/rdf+xml:
application/owl+xml:
application/json
```

#### Send the description request of VIVO-PROXY

```bash
curl -X 'GET' 'http://localhost:9090/vivoproxy/vivo?IRI=http%3A%2F%2Flocalhost%3A8080%2Fvivo%2Findividual%2Fn7723' -H 'accept: text/turtle' 
``` 

#### Type of response expected un TURTLE

```
@prefix ns: <http://www.w3.org/2003/06/sw-vocab-status/ns#> .
@prefix obo: <http://purl.obolibrary.org/obo/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

. . .
#################################################################
#    Individuals
#################################################################

###  http://localhost:8080/vivo/individual/n7723
<http://localhost:8080/vivo/individual/n7723> rdf:type owl:NamedIndividual ,
                                                       obo:BFO_0000001 ,
                                                       obo:BFO_0000002 ,
                                                       obo:BFO_0000004 ,
                                                       core:FacultyMember ,
                                                       owl:Thing ,
                                                       <http://xmlns.com/foaf/0.1/Agent> ,
                                                       <http://xmlns.com/foaf/0.1/Person> ;
                                              obo:ARG_2000028 <http://localhost:8080/vivo/individual/n6394> ;
                                              vitro:mostSpecificType core:FacultyMember ;
                                              core:relatedBy <http://localhost:8080/vivo/individual/n4831> ;
                                              rdfs:label "Peters I Jasper"@fr-ca .
. . .
```

<hr>

## 5- Adding hasResearchArea and researchAreaOf in VIVO

This UC is particularly useful to define the expertise that will be presented by the Capability-Map 

To realize this UC, it is necessary to create a Concept representing the researcheArea and linking the person to this concept through the APIs: 
- `http://localhost:9090/vivoproxy/person/personHasAddResearchArea` 
- `http://localhost:9090/vivoproxy/person/personAddResearchAreaOf` 
- `http://localhost:9090/vivoproxy/concept`


#### The data model of aResearchArea.json

```json
{
  "IRI": "http://purl.org/uqam.ca/vocabulary/expertise#semanticweb",
  "labels": [
    {
      "label": "semantic web",
      "language": "en-US"
    },
    {
      "label": "web sémantique",
      "language": "fr-CA"
    }
  ]
}
```

This API requires an IRI to create the Concept. It is also possible to label the concept in several languages. In this example, the label is created for English and French eand the semantic web search domain

#### Send the person data model of VIVO-PROXY

```bash
curl -X 'POST' 'http://localhost:9090/vivoproxy/concept' -H 'accept: application/json' -H 'Content-Type: application/json' -d @aResearchArea.json
``` 

#### Type of response expected

```json
{
  "code": 4,
  "type": "ok",
  "apiMessage": null,
  "IRI-value": "http://purl.org/uqam.ca/vocabulary/expertise#semanticweb",
  "VIVO-Message": "<H1>200 SPARQL update accepted.</H1>\r\n"
}
```


#### see result at:

http://localhost:8080/vivo/research


#### Attach ResearchArea to a person in VIVO-PROXY

Let's assume that we want to attach the 'semantic web' research domain (`http://purl.org/uqam.ca/vocabulary/expertise#semanticweb`) to a person designated by `http://localhost:8080/vivo/individual/n7723`

We can execute the following commands:

```bash
curl -X 'PUT' 'http://localhost:9090/vivoproxy/person/addHasResearchArea' -H 'accept: application/json' -H 'Content-Type: application/json' -d '{ "subject-IRI": "http://localhost:8080/vivo/individual/n7723",  "object-IRI": "http://purl.org/uqam.ca/vocabulary/expertise#semanticweb" }'


curl -X 'PUT' 'http://localhost:9090/vivoproxy/person/addResearchAreaOf' -H 'accept: application/json' -H 'Content-Type: application/json' -d '{ "subject-IRI": "http://localhost:8080/vivo/individual/n7723",  "object-IRI": "http://purl.org/uqam.ca/vocabulary/expertise#semanticweb" }'
``` 

#### see result for this specific user at at:

http://localhost:8080/vivo/display/n7723

<hr>

# In case of problems

It is possible that the results obtained do not correspond to the expected results. Here are a few ways to solve the problem :
- Make sure that VIVO is started: http://localhost:8080/vivo/
- Make sure that VIVO-PROXY is started: http://localhost:9090/
- Use the HTML api presented at http://localhost:9090/ by clicking on the 'try it out' button and scrolling to the api you want to use
- Make sure that the LOGIN settings are correctly configured see [2) Configure VIVO-LOGIN for VIVO-PROXY by performing the following commands](https://github.com/vivo-community/VIVO-PROXY/tree/issues-3#2-configure-vivo-login-for-vivo-proxy-by-performing-the-following-commands)  

<hr>
